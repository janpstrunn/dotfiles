#!/usr/bin/sh

# "Play video from FreeTube history file"

NEWSBOAT_HISTORY_FILE=$HOME/.local/share/newsboat-history.db

getPlayer() {
  case "$1" in
  freetube)
    setsid -f freetube "https://www.youtube.com/watch?v=$videoId" >/dev/null
    ;;
  *)
    setsid -f mpv -quiet "https://www.youtube.com/watch?v=$videoId" >/dev/null
    ;;
  esac
}

runPlayer() {
  videoId=$(jq -c '. | {author, title, description, videoId}' "$NEWSBOAT_HISTORY_FILE" | fzf | jq -r '.videoId')
  [ -z "$videoId" ] && return 1
  getPlayer "$1"
}

main() {
  [ -f "$NEWSBOAT_HISTORY_FILE" ] && runPlayer "$1" && echo "Starting video in the background..."
}

main "$1"
