#!/usr/bin/sh

# "Gracefully halt the system"

EXIT_CMD=poweroff

stop_services() {
  command -v podman >/dev/null 2>&1 && {
    echo "Stopping Podman Containers..."
    podman stop --all >/dev/null
  }
  command -v tmux >/dev/null 2>&1 && {
    echo "Stopping Tmux Sessions..."
    tmux kill-server
  }
  command -v tomb >/dev/null 2>&1 && {
    echo "Slamming open Tombs..."
    tomb slam
  }
}

main() {
  cmd=${1:-"$EXIT_CMD"}
  stop_services
  echo "See ya!"
  sleep 2
  if [ "$cmd" = "reboot" ]; then
    reboot
  else
    poweroff
  fi
}

main "$@"
